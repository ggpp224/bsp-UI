<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<meta content="教师网联" name="keywords" />
<meta content="教师网联" name="description" />
<title>修改课程 - 教师网联</title>
<link href="css/reset.css" rel="stylesheet" type="text/css" />
<link href="css/style.css" rel="stylesheet" type="text/css" />
<link href="css/nyroModal.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/bases.js"></script>

<!--[if lt IE 9]>
<script type="text/javascript" src="js/html5.js"></script>
<![endif]-->
<!--[if IE 6]>
<script type="text/javascript" src="js/DD_belatedPNG_0.0.8a-min.js" ></script>
<script type="text/javascript">DD_belatedPNG.fix('.toplogo img');   </script>
<![endif]-->

<script type="text/javascript">
	$(document).ready(function() {
		summary.tabs();//Tabs
		summary.tablehover();//Hover

		//课程代码
		$(".course_code").focus(function(e) {
			e.preventDefault();
			$.fn.nyroModalManual({
				width : 650,
				title : '批次代码',
				url : 'overlay_addcourse.html'
			});
			return false;
		});



	});
</script>

</head>
<body>
<!-- Header -->
	<div class="page_head">
		<div class="wrapper">
			<!-- #BeginLibraryItem "/Library/logoinformation.lbi" -->
			<div class="toplogo">
				<img src="images/logo.png" alt="全国教师教育网络联盟" />
			</div>
			<div class="topnav">
				<b><a href="style.html">Admin</a></b>，欢迎你登陆 <span>|</span> <a
					href="#">退出</a>
			</div>
			<!-- #EndLibraryItem -->




		</div>
	</div>
	<!-- Header End -->


	<!-- Page title -->
	<div class="pagetitle">
		<span><h1>互选课程总库</h1><h2>&nbsp;→&nbsp;课程列表</h2><h2>&nbsp;→&nbsp;修改课程</h2></span>
	</div>
	<!-- Page title End -->



	<!-- Page -->
	<div class="page_content">

<!-- LEFT -->
         <div class="page_left">
			<div id="navMenu" class="arrowlistmenu"></div>
		</div>
         <!-- LEFT -->
  		<!-- RIGHT -->
        <div class="page_right">

		<fieldset>
			<legend class="big">修改课程</legend>
		</fieldset>

		<div id="tablist">
			<ul id="explore_nav">
				<li id="ex_tab1"><a rel="tab01" href="#" class="current">课程基本信息</a></li>
				<li id="ex_tab2"><a rel="tab02" href="#">任课教师信息</a></li>
			</ul>
			<div id="tablist_cont">
				<form id="tab01" method="post" action="">
					<div class="clearfix">
						<p>
							<label class="labeltitle">课程代码：</label><input type="text" id=""
								name="serialCode" disabled="disabled" value="新增时系统自动生成" />
						</p>
						<div class="column width5 first">

							<p>
								<label class="labeltitle"><span style="color:red">*</span>课程名称：</label>
								<input type="text" id="courseName" class="half" name="courseName" value="" />
								<span id='cNameInfo' class="hidden">不能为空</span>
							</p>

							<p>
								<label class="labeltitle"><span style="color:red">*</span>课程来源：</label>
								<input type="text" id="lmsCode" class="half" name="lmsCode" value="" />
								<span id='lmsCodeInfo' class="hidden">不能为空</span>
							</p>

							<p>
								<label class="labeltitle"><span style="color:red">*</span>批次名称：</label><input type="text"
									 id="courseNameStandard" value="点击添加"  class="half overlay_input course_code" name="courseNameStandard"
									 />
								<span id='cCNtInfo' class="hidden">必须选择</span>
							</p>
							<p>
								<label class="labeltitle">授课学校：</label><input type="text"
									id="school" class="half" name="" disabled="disabled"
									value="" /> <input type="hidden"
									name="schoolCode" id="schoolCode" value="" />
							</p>
							<p class="hs">
								<label class="labeltitle"><span style="color:red">*</span>适用专业：</label><select name="majorCode"
									id="form_major" iclass="half"></select>
							</p>
							<p>
								<label class="labeltitle"><span style="color:red">*</span>课程类别：</label><select id="courseType" name="courseType"
									class="half"><option value="null">请选择</option><option value="1">学历教育</option>
									<option value="2">非学历教育</option></select>
							</p>

							<p>
								<label class="labeltitle">开课学期：</label><select id="courseXueqi" 
									class="half"><option value="1">春季</option>
									<option value="2">秋季</option></select>
							</p>
						</div>
						<div class="column width5">
							<p>
								<label class="labeltitle">课程英文名：</label><input type="text" id="courseEname"
									class="half" name="courseEname" value="" />
								<span id='enameInfo' class="hidden"></span>
							</p>
							<p>
								<label class="labeltitle"><span style="color:red">*</span>原课程代码：</label><input type="text" id="lmsOriCourseCode"
									class="half" name="lmsOriCourseCode" value="" />
								<span id='lmsOriCourseCodeInfo' class="hidden"></span>
							</p>
							<p>
								<label class="labeltitle">批次代码：</label><input type="text"
									id="courseCodeStandard" class="half" disabled="disabled"
									name="courseCodeStandard" value="自动带入，不允许编辑"  />
									<span id='cCStInfo' class="hidden">必须选择</span>
							</p>
							<p>
								<label class="labeltitle"><span style="color:red">*</span>所属学科：</label><select
									name="subjectCode" id="form_subject" class="half"></select>
							</p>

							<p>
								<label class="labeltitle"><span style="color:red">*</span>教学组织形式：</label> <select
									name="tchOgzForm" id="tchOgzForm" class="half">
									<option value="null">请选择</option>
									<option value="1">个别教学制</option>
									<option value="2">班级授课制</option>
									<option value="3">分组教学制</option>
									<option value="4">开放教学制</option>
								</select>
							</p>
							<p class="hs">
								<label class="labeltitle"><span style="color:red">*</span>适用层次：</label><select
									name="educationLevelCode" id="form_educationlevel"
									class="half"></select>
							</p>
							<p class="hs">
								<label class="labeltitle"><span style="color:red">*</span>适用年级：</label><select name="gradeCode"
									id="form_grade" class="half"></select>
							</p>
						</div>
					</div>
					<p>
						<label class="labeltitle">所属专业：</label>
						<input type="button" class="btn btn_blue" id="addMajorBtn" value="添加专业"/>
						<input type="button" class="btn btn_red" id="removeMajorBtn" value="移除选中专业"/>
					</p>
					<div>
						<label class="labeltitle">&nbsp;</label>
                          <table class="tablebox tablebox_inner" style="width: 75%;">
	                          <thead class="table_header">
	                                <tr>
	                                <th class="first tc" width="4%" ><input type="checkbox" id="checkboxall_m"></input></th>
	                                <th>专业代码</th>
	                                <th>专业名称</th>
	                                </tr>
	                          </thead>

	                          <tbody id="majorInfo_tbody" class="openable_tbody">

	                          </tbody>
                		  </table>
                		  <span id='majorsInfo' class="hidden">至少添加一项专</span>
					</div>
					<p>
						<label class="labeltitle"><span style="color:red">*</span>课程简介：</label>
						<textarea id="area2" class="small" cols="96"
							name="courseIntroduction"></textarea>
						<span id='area2Info' class="hidden">不能为空</span>
					</p>
					<p>
						<label class="labeltitle">基本要求：</label>
						<textarea class="small" cols="96" id="basicRequirement" name="basicRequirement"></textarea>
						<span id='basicInfo' class="hidden"></span>
					</p>
					<p>
						<label class="labeltitle">教材及参考资料：</label>
						<textarea class="small" cols="96" id="textbook"  name="textbook"></textarea>
						<span id='textbookInfo' class="hidden"></span>
					</p>
					<p>
						<label class="labeltitle"><span style="color:red">*</span>考核内容：</label>
						<textarea class="small" cols="96" id="examContent" name="examContent"></textarea>
						<span id='ecInfo' class="hidden">不能为空</span>
					</p>
					<p>
						<label class="labeltitle">资源建设情况：</label>
						<textarea id="resourceConstruction" class="small" cols="96"
							name="resourceConstruction"></textarea>
						<span id='resourceInfo' class="hidden"></span>
					</p>
					<p>
						<label class="labeltitle">演示版链接：</label>
						<textarea id="demoLink" class="small" cols="96" name="demoLink"></textarea>
						<span id='linkInfo' class="hidden"></span>
					</p>


					<div class="btn_opera">
						<input type="button" id="course_save" class="btn btn_blue"
							value="保存" /> <input id="cBackBtn" type="button" class="btn backBtn btn_gray"
							 value="关闭" />
					</div>

				</form>


				<form id="tab02" method="post" action="">

					<fieldset>
						<legend>已新增的老师</legend>
					</fieldset>
					<div class="box_header">
					<input id="form_show" type="button" class="btn btn_blue " value="新增"/>
						<input id="teacher_del" type="button"
							class="btn btn_red overlay_delete" value="删除" />
					</div>
					<div class="box_content">
						<table class="tablebox">
							<thead class="table_header">
								<tr>
									<th class="first tc" width="4%"><input type="checkbox"
										id="checkboxall" /></th>
									<th>教师名称</th>
									<th>教师单位</th>
									<th>教师职称</th>
									<th>电话</th>
									<th>E-MAIL</th>
									<th>操作</th>
								</tr>
							</thead>

							<tbody id="teacher_tbody" class="openable_tbody">

							</tbody>
						</table>
					</div>
				<div id="teacher_form">
					<fieldset>
						<legend>新增老师</legend>
					</fieldset>
					<div class="clearfix">
						<div class="column width5 first">
							<p>
								<label class="labeltitle"><span style="color:red">*</span>教师名称：</label><input type="text"
									class="half" id="teacherName" name="teacherName" value="" />
								<span id='teacherNameInfo' class="hidden">不能为空</span>
							</p>
							<p>
								<label class="labeltitle"><span style="color:red">*</span>教师职称：</label><input type="text"
									class="half" id="teacherTitle" name="teacherTitle" value="" />
								<span id='teacherTitleInfo' class="hidden">不能为空</span>
							</p>
							<p>
								<label class="labeltitle">电话：</label><input type="text"
									class="half" id="teacherPhone" name="teacherPhone" value="" />
									<span id='phoneInfo' class="hidden">不能为空</span>
							</p>
						</div>
						<div class="column width5">
							<p>
								<label class="labeltitle"><span style="color:red">*</span>教师单位：</label><input type="text"
									class="half" id="teacherUnit" name="teacherUnit" value="" />
								<span id='teacherUnitInfo' class="hidden">不能为空</span>
							</p>
							<p>
								<label class="labeltitle"><span style="color:red">*</span>Email：</label><input type="text"
									class="half" id="teacherEmail" name="teacherEmail" value="" />
								<span id='teacherEmailInfo' class="hidden">不能为空</span>
							</p>
							<input type="hidden" id="teacherCourseCode" name="courseCode"
								value="" />
						</div>

					</div>

					<p>
						<label class="labeltitle"><span style="color:red">*</span>教师简介：</label>
						<textarea class="small" cols="96" id="teacherIntroduction" name="teacherIntroduction"></textarea>
						<span id='teacherIntroductionInfo' class="hidden">不能为空</span>
					</p>
					</div>
					<div class="btn_opera">
						<!-- <input id="teacherEditBtn" type="button" class="btn btn_blue" value="保存" /> -->
						<input id="teacherAddBtn" type="button" class="btn btn_red" value="保存" />
						<input id="teacherConAddBtn" type="button" class="btn btn_green" value="保存并继续添加" />
						<input id="teacherBackBtn"  rec="" type="button" class="backBtn btn btn_blue" value="关闭" />
					</div>
				</form>
			</div>
		</div>

	</div>
	<!-- Page End -->
	<!-- #BeginLibraryItem "/Library/footer.lbi" -->
	<div class="clearfix"></div>
        </div>


<div class="page_footer">
<p>主管单位：教育部 　主办单位：全国教师教育网络联盟</p>
<p>全国教师教育网络联盟秘书处 电话：010－58802946 电子信箱：msz@jswl.cn</p>
<p>全国教师教育网络联盟 版权所有 京ICP备05069600号 </p>
</div>

	<!-- #EndLibraryItem -->


	<!-- script begin -->
		<script type="text/javascript">document.write('\<script id="jsdata" type="text/javascript" src="js/data.js?t='+new Date().valueOf()+'"\>\<\/script\>');</script>

		<script type="text/javascript">
		var oper_type="add";
		var queryUrl = '';

		$(document).ready(function(){
			$('#teacherEditBtn').hide();
			$('#teacher_form').hide();
			$('#teacherAddBtn').hide();
			$('#teacherConAddBtn').hide();


			$('#form_show').click(function(){
				oper_type="add";
				$('#teacher_form').show();
				$('#teacherAddBtn').show();
				$('#teacherConAddBtn').show();
			});
			//授课学校init
		 	var courseCode = getQuery("c");
		 	var schoolCode = getQuery("s");
		 	var courseId = getQuery("i");
		 	var courseName = getQuery("n");
		 	document.getElementById("schoolCode").value=schoolCode;
		 	$('#idHidden').val(courseId);
		 	var cmb = new ComboxOperate();
		 	//专业
		 	cmb.major({all:true});

			// 学科
			cmb.subject({all:true});

			// 层次和年级
			cmb.levelAndGrade({all:true});

			var courseCode = '';
			var pn=getQuery('pn')||1;
			var teachers ={};
			function teacherList(){
				$.getJSON(G_ROOT+G_FormArr['teacherList']+'/'+courseCode,function(data){
					teachers ={};
					disCheckedHeader();
						var data = data.list;
						var htm  = '';
						for(var i=0,len=data.length;i<len;i++){
							var v =data[i];
							teachers[v.ID]=v;
							htm += '<tr>' +
									'<td class="first tc"><input ids="'+v.ID+'"  type="checkbox" name="checkall" ></td>' +
									'<td>'+v.TEACHER_NAME+'</td>' +
									'<td>'+v.TEACHER_UNIT+'</td>' +
									'<td>'+v.TEACHER_TITLE+'</td>' +
									'<td>'+v.TEACHER_PHONE+'</td>' +
									'<td>'+v.TEACHER_EMAIL+'</td>' +
									'<td><a class="edit" rec='+v.ID+' href="javascript:void(0)">编辑</a></td>' +
								  '</tr>';
						}
						htm = throwNull(htm);
						$('#teacher_tbody').html(htm);

						$('.edit').unbind('click').bind('click',function(){
							var str = this.getAttribute('rec');
							var obj = teachers[str];
							var form = document.getElementById('tab02');
							var els = form.elements;

							els.teacherEmail.value=obj.TEACHER_EMAIL;
							els.teacherIntroduction.value=obj.TEACHER_INTRODUCTION;
							els.teacherName.value=obj.TEACHER_NAME;
							els.teacherPhone.value=obj.TEACHER_PHONE;
							els.teacherUnit.value=obj.TEACHER_UNIT;
							els.teacherTitle.value=obj.TEACHER_TITLE;
							$('#teacherAddBtn').attr('rec',obj.ID);
							//$('#teacherEditBtn').show();
							$('#teacher_form').show();
							$('#teacherAddBtn').show();
							oper_type="edit";

						});

					});
			}

			function teacherEdit(){
				if(!validateTeacher()){
					return false;
				}
				var form_2 = document.forms['tab02'];
				var params = Ab.urlDecode(Ab.serializeForm(form_2));
				params.courseCode = courseCode;
				params.id = $('#teacherAddBtn').attr('rec');
				params.updater = user['uid'];
				var str = Ab.encode(params);
				$.ajax({
					type: "POST",
					data: str,
					dataType:"json",
					url:G_ROOT+'course/courseteacher/update'+'?termId='+params.termId,
					contentType:'application/json;charset=UTF-8',
					success: function(rs){
						if(rs.returnCode=='000000'){
							teacherList();
							var els = form_2.elements;
							for(var i=0,len=els.length;i<len;i++){
								var el = els[i];
								if(el.type == 'text'||el.type == 'textarea'){
									el.value="";
								}
							}
							msgBox.show('修改成功。');
							teacherList();
							//$('#teacherEditBtn').hide();


						}else if(rs.returnCode='100'){
							mAlert('一门课程最多只能添加5名教师');
						}else{
							msgBox.show('修改失败。');
						}

					}
				});
			}

			function teacherAdd(){
				if(!validateTeacher()){
					return false;
				}
				var form_2 = document.forms['tab02'];
				var params = Ab.urlDecode(Ab.serializeForm(form_2));
				params.courseCode = courseCode;
				params.creater = user['uid'];
				var str = Ab.encode(params);
				$.ajax({
					type: "POST",
					data: str,
					dataType:"json",
					url:G_ROOT+G_FormArr['teacherAdd'],
					contentType:'application/json;charset=UTF-8',
					success: function(rs){
						if(rs.returnCode=='000000'){
							teacherList();
							var els = form_2.elements;
							for(var i=0,len=els.length;i<len;i++){
								var el = els[i];
								if(el.type == 'text'||el.type == 'textarea'){
									el.value="";
								}
							}
							mAlert('添加成功。');

						}else if(rs.returnCode=='100'){
							mAlert('一门课程只能添加最多五名教师');
						}else{
							mAlert('添加失败。');
						}

					}
				});
			}


			$('#teacherAddBtn').click(function(){
				var flag = true;
				if(oper_type=='add'){
					if(!teacherAdd()){
						flag=false;
					}
				}else{
					if(!teacherEdit()){
						flag=false;
					}
				}
				if(flag){
					$('#teacher_form').hide();
					$('#teacherAddBtn').hide();
					$('#teacherConAddBtn').hide();
				}

			});

			$('#teacherConAddBtn').click(function(){
					var flag = true;
					if(oper_type=='add'){
						if(teacherAdd()){
							flag=false;
						}
					}else{
						if(teacherEdit()){
							flag=false;
						}
					}
					if(!flag){
						$('#teacher_form').show();
						$('#teacherAddBtn').show();
						$('#teacherConAddBtn').show();
						oper_type='add';
					}


			});


			$.getJSON(G_ROOT+G_FormArr['courseData']+"/"+courseId,function(data){
				var dt = data.entity;
				if(dt){
					var form = document.getElementById('tab01');
					var els = form.elements;
					courseCode=els.serialCode.value=dt.courseCode;
					els.courseName.value = dt.courseName;
					els.courseEname.value = dt.courseEname||'';
					els.school.value = G_data['school'][dt.schoolCode];
					els.majorCode.value = 'null';
					els.educationLevelCode.value = dt.educationLevelCode;
					els.courseType.value = dt.courseType;
					els.gradeCode.value = dt.gradeCode;
					els.courseCodeStandard.value = dt.courseCodeStandard;
					els.courseNameStandard.value = decodeURI(dt.courseNameStandard);
					els.basicRequirement.value = dt.basicRequirement||'';
					els.textbook.value = dt.textbook||'';
					els.examContent.value = dt.examContent||'';
					els.resourceConstruction.value = dt.resourceConstruction||'';

					els.demoLink.value = dt.demoLink||'';
					els.courseIntroduction.value = dt.courseIntroduction||'';
					els.subjectCode.value = dt.subjectCode||'';
					els.tchOgzForm.value = dt.tchOgzForm||'';
					els.lmsCode.value=dt.lmsCode;
					els.lmsOriCourseCode.value=dt.lmsOriCourseCode;
					win.renderMajors(dt.majorList);

				}

				teacherList();
			});

			$('#course_save').click(function(){
				if(!validate()){
					return;
				}
				var params = Ab.urlDecode(Ab.serializeForm('tab01'));
				params.id = courseId;
				courseCode = params.courseCodeStandard;
				params.majorList = win.getPostCodes();
				params.updater = user['uid'];
				delete params.serialCode;
				var str = Ab.encode(params);
				$.ajax({
					type: 'POST',
					data:str,
					dataType: 'json',
					url: G_ROOT+G_FormArr['courseUpdate'],
					contentType:'application/json;charset=UTF-8',
					success: function(rs) {
		                       if(rs.returnCode=="000000"){
									$.fn.nyroModalManual({
										width:400,
										title:"系统提示",
										content: '<div class="overlay_delete_box"><h5 class="red"><img src="images/delete_ico.gif" />修改成功</h5></div><div class="overlay_btn"><input type="button" id="win_sure" class="btn btn_red " value="确定" onclick="location=\'index.html?pn='+pn+'\'" /></div>'
									});
		                    	   //location.href = "index.html?pn="+pn;
									$('#teacher_form').hide();
									$('#teacherAddBtn').hide();
		                       }else{
		                    	   mAlert("操作失败。");
		                       }
		                    }


				});

			});

			$('.backBtn').click(function(){
				//location.href="index.html?pn="+pn;
				window.close();
			});


			$('#teacher_del').click(function(){
				var ids = getIds('teacher_tbody');
				if(ids.length==0){
					alert('请选择要删除的教师');
					return;
				}
				if(!confirm("删除后将无法恢复，确定删除？")){
					return;
				}

				var url = G_ROOT+"course/courseteacher/delete";

				var str = Ab.encode(ids);
				$.ajax({
					type: "POST",
					data: str,
					dataType:"json",
					url:url,
					contentType:'application/json;charset=UTF-8',
					success: function(rs){
						if(rs.returnCode='000000'){
							teacherList();
							msgBox.show('删除成功。');
						}else{
							msgBox.show('删除失败。');
						}

					}
				});

			});

			tableCheckAll('teacher_tbody');

			//验证课程添加
			function validate(){
				var checked = true;

				var inputCheck = function(dom,jdom,len){
					var len = len||50;
					var val = dom.val();
					if(val.trim().length==0){
						jdom.html('不能为空');
						jdom.removeClass('hidden').addClass('error');
						checked=false;
					}
					else if(val.length>len){
						jdom.html('不能超过'+len+'字');
						jdom.removeClass('hidden').addClass('error');
						checked=false;
					}else{
						jdom.removeClass('error').addClass('hidden');
					}
				};

				//课程名称
				var cn = $('#courseName');
				var cnVal = cn.val();
				var jdom = $('#cNameInfo');
				if(cnVal.trim().length==0){
					jdom.html('不能为空');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(cnVal.length>100){
					jdom.html('不能超过100字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				//批次代码
				var cs = $('#courseNameStandard');
				var csVal = cs.val(),
					jdom = $('#cCNtInfo');
				if(csVal=='点击添加'){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(csVal.trim().length>100){
					jdom.html('不能超过100字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				//课程简介
				var a2 = $('#area2'),
					a2Val = a2.val(),
					jdom = $('#area2Info');

				if(a2Val.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(a2Val.length>400){
					jdom.html('不能超过400字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				//成绩构成方式
				var ec = $('#examContent'),
					ecVal = ec.val(),
					jdom = $('#ecInfo');
				if(ecVal.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(csVal.length>400){
					jdom.html('不能超过400字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				var longCheck = function(dom,jdom,len){
					var len = len||200;
					var val = dom.val();
					if(val.length>len){
						jdom.html('不能超过'+len+'字');
						jdom.removeClass('hidden').addClass('error');
						checked=false;
					}else{
						jdom.removeClass('error').addClass('hidden');
					}
				};

				//课程英文名
				longCheck($('#courseEname'),$('#enameInfo'),50);
				//
				inputCheck($('#lmsCode'),$('#lmsCodeInfo'),50);
				//
				inputCheck($('#lmsOriCourseCode'),$('#lmsOriCourseCodeInfo'),50);
				//基本要求
				longCheck($('#basicRequirement'),$('#basicInfo'),250);
				//教材及参考资料
				longCheck($('#textbook'),$('#textbookInfo'),250);
				//资源建设情况
				longCheck($('#resourceConstruction'),$('#resourceInfo'),250);
				//演示版链接
				longCheck($('#demoLink'),$('#linkInfo'),100);

				//checked = valiInput($('#form_major'),{emptyText:'请选择一项'})?checked:false;
				checked = valiInput($('#courseType'),{emptyText:'请选择一项'})?checked:false;
				checked = valiInput($('#tchOgzForm'),{emptyText:'请选择一项'})?checked:false;
				checked = valiInput($('#form_subject'),{emptyText:'请选择一项'})?checked:false;
				//checked = valiInput($('#form_educationlevel'),{emptyText:'请选择一项'})?checked:false;
				//checked = valiInput($('#form_grade'),{emptyText:'请选择一项'})?checked:false;
				/* if(win.getMajorCodes().length==0){
					$('#majorsInfo').removeClass('hidden').addClass('error');
					checked=false;
				}else{
					$('#majorsInfo').removeClass('error').addClass('hidden');
				}
 */
				var dd = maskForm('tab01');
				if(!dd){
					checked = false;
				}
				return checked;
			}

			function validateTeacher(){
				var checked = true;

				//教师名称
				var cn = $('#teacherName');
				var val = cn.val(),
					jdom = $('#teacherNameInfo');
				if(val.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(val.length>50){
					jdom.html('不能超过50字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				//邮箱
				var cs = $('#teacherEmail');
				var val = cs.val(),
					jdom = $('#teacherEmailInfo');
				if(val.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(!(/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{1}$/.test(cs.val()))){
					jdom.html('邮箱格式不正确');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(val.length>50){
					jdom.html('不能超过50字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					$('#teacherEmailInfo').removeClass('error').addClass('hidden');
				}

				//教师单位
				var a2 = $('#teacherUnit');
				var val = a2.val(),
					jdom = $('#teacherUnitInfo');
				if(val.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(val.length>50){
					jdom.html('不能超过50字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				//教师简介
				var ec = $('#teacherIntroduction');
				var val = ec.val(),
					jdom = $('#teacherIntroductionInfo');
				if(val.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(val.length>2000){
					jdom.html('不能超过2000字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}

				//职称
				var tt = $('#teacherTitle');
				var val = tt.val(),
					jdom = $('#teacherTitleInfo');
				if(val.trim().length==0){
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else if(val.length>50){
					jdom.html('不能超过50字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}
				//电话号码
				var pc = $('#teacherPhone');
				var val = pc.val(),
					jdom = $('#phoneInfo');
				if(val.length>25){
					jdom.html('不能超过25字');
					jdom.removeClass('hidden').addClass('error');
					checked=false;
				}else{
					jdom.removeClass('error').addClass('hidden');
				}
				var dd = maskForm('tab02');
				if(!dd){
					checked = false;
				}
				return checked;
			}

			//绑定“添加专业“按钮
			$('#addMajorBtn').click(function() {
				$.fn.nyroModalManual({
					width:600,
					height:450,
					title:"新增",
					content: win.pop()
				});
				$("#Btn_majorSearch").click();
				return false;
			});

			//绑定“移除专业“按钮
			$('#removeMajorBtn').click(function() {
				win.removeMajors();
			});

			//绑定查询按钮

			$("#Btn_majorSearch").live('click',function(){
				params = Ab.urlDecode(Ab.serializeForm('majorSeach'));
				var queryTest='';
				//queryUrl+=queryTest;
				queryUrl='major/query/'+(params.majorcode==''?'null':params.majorcode)+"/"
						+(params.majorname==''?'null':params.majorname)+"/"
						+(params.subjectcode==''?'null':params.subjectcode)+"/1/"
					;
				$('#js_tablebox,#major_pageShow').empty();
				win.getList(1);
			});

			tableCheckAll('majorInfo_tbody',null,'checkboxall_m');

		});

		 var win = {
						pop : function(){
							var html_subject='<option value="null">全部</option>';
							for(var i in G_data['subject']){
								html_subject+='<option value="'+i+'">'+G_data['subject'][i]+'</option>'
							}
							var html='<form id="majorSeach" name="majorSeach" method="post" action="#">';
								html+='<p><label class="labeltitle">专业代码：</label><input type="text" id="majorcode" class="half" name="majorcode" value=""  /></p>';
								html+='<p><label class="labeltitle">专业名称：</label><input type="text" id="majorname" class="half" name="majorname" value=""  /></p>';
								html+='<p><label class="labeltitle">所属学科：</label><select name="subjectcode">'+html_subject+'</select></p>';
								html+='<div class="btn_opera"><input type="button" id="Btn_majorSearch" class="btn btn_gray" value="查询"/></div>';
								html+='<table class="tablebox" id="js_tablebox"></table>';
								html+='<div id="major_pageShow"></div>';
								html+='<div class="overlay_btn"><input type="button" onclick="win.subm()" class="btn btn_green" value="确定添加"/> <input type="button" class="btn btn_gray overlayClose" value="关闭"/></div>';
								html+='</form>';
							return html;
						},

						getList : function(page){
							page = (page && page>0)?page=page:page=Math.abs(page);
							var url=G_ROOT + encodeURI(queryUrl) + page+'/'+G_perpage_pop;

							if($('#js_thead_'+page).length>0){
								$('.js_thead,.js_tbody').hide();
								$('#js_thead_'+page).show();
								$('#js_tbody_'+page).show();
								$('#major_pageShow').html(gPage(rCount,page,'win.getList',G_perpage_pop));
							}else{
								$.getJSON(url,function(data){
									rCount=data.rCount;
									var list = data.list;
									var html='<thead id="js_thead_'+page+'" class="table_header js_thead">';
										html+='	<tr>';
										html+='	<th class="first tc" width="4%"><input type="checkbox" id="checkboxall_pop" onclick="checkAll(this,\'majorChk_'+page+'\')"/></th>';
										html+='	<th>专业代码</th>';
										html+='	<th>专业名称</th>';
										html+='	<th>所属学科</th>';
										html+='	</tr>';
										html+='</thead>';
										html+='<tbody id="js_tbody_'+page+'" class="openable_tbody js_tbody">';
									if(list){
										$.each(list,function(k,v){
											html+='<tr class="mid'+v.id+'">';
											html+='<td class="first tc"><input type="checkbox" class="dt majorChk_'+page+'" name="checkall" value="'+v.code+'" /></td>';
											html+='<td class="dt">'+v.code+'</td>';
											html+='<td class="dt">'+v.name+'</td>';
											html+='<td class="subject">'+G_data['subject'][v.subjectCode]+'</td>';
											html+='</tr>';
										});
									}
									html+='</tbody>';
									html = throwNull(html);
									$('.js_thead,.js_tbody').hide();
									$('#js_tablebox').append(html);
									$('#major_pageShow').html(gPage(data.rCount,page,'win.getList',G_perpage_pop));
									patch();
								});
							}
						},

						getMajorCodes:function(){
							var hcs=[];
							var cs = $('#majorInfo_tbody').find('.cd');
							cs.each(function(){
								hcs.push(this.innerHTML);
							});
							return hcs;
						},

						subm:function(){
							var d=[],htm='',hcs=this.getMajorCodes(),trs=$('.js_tbody').find('tr') ;
							var flag=true;
							trs.each(function(idx,el){
								var dts = $(el).find('.dt');
								var o = {code:dts[1].innerHTML,name:dts[2].innerHTML};
								if(dts[0].checked){
									flag=false;
								}
								if(dts[0].checked && (hcs.indexOf(o.code)==-1)){
									htm += '<tr><td><input type="checkbox"></td><td class="cd">'+o.code+'</td><td>'+o.name+'</td></tr>'
									d.push(o);
								}

							});
							if(flag){
								alert('请选择专业');
								return false;
							}
							$('#majorInfo_tbody').append(htm);
							$('.overlayClose').click();
						},

						renderMajors: function(dt){
							var dt = dt||[];
							if(typeof dt =='string'){dt=[]};
							var htm = '';
							for(var i=0,len=dt.length;i<len;i++){
								var o = dt[i];
								htm += '<tr><td><input type="checkbox"></td><td class="cd">'+o.code+'</td><td>'+o.name+'</td></tr>';
							}
							$('#majorInfo_tbody').append(htm);
						},
						getPostCodes:function(){
							var hcs=[];
							var cs = $('#majorInfo_tbody').find('.cd');
							cs.each(function(){
								hcs.push({code:this.innerHTML});
							});
							return hcs;
						},
						removeMajors: function(){
							var trs = $('#majorInfo_tbody').find('tr');
							trs.find('input[type=checkbox]').each(function(idx,val){
								if(this.checked){
									$(trs[idx]).remove();
								}
							});
						}
					};

		</script>
	<!-- script end -->
	<script type="text/javascript" src="js/menu.js"></script>
</body>
</html>
